<div class="dashboard-container">
  <div class="dashboard-header">
    <div>
      <h1 class="dashboard-title">{{ greeting() }}!</h1>
      <p class="dashboard-subtitle">Bem-vindo ao seu painel de controle</p>
    </div>
    <button class="btn-refresh" (click)="recarregar()" [disabled]="isLoading()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
      </svg>
      Atualizar
    </button>
  </div>

  <!-- Cards de Estatísticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Total Pacientes</span>
        <span class="stat-value">{{ stats()?.totalPacientes || 0 }}</span>
      </div>
      <div class="stat-icon stat-icon-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Consultas Hoje</span>
        <span class="stat-value">{{ stats()?.consultasHoje || 0 }}</span>
      </div>
      <div class="stat-icon stat-icon-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Este Mês</span>
        <span class="stat-value">{{ stats()?.consultasMes || 0 }}</span>
      </div>
      <div class="stat-icon stat-icon-success">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Próxima Consulta</span>
        <span class="stat-value">{{ stats()?.proximaConsulta || 'N/A' }}</span>
      </div>
      <div class="stat-icon stat-icon-warning">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </div>
    </div>
  </div>

  <!-- Ações Rápidas -->
  <div class="quick-actions">
    <h2 class="section-title">Ações Rápidas</h2>
    <div class="actions-grid">
      <button class="action-card" (click)="novoPaciente()">
        <div class="action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="action-content">
          <h3>Novo Paciente</h3>
          <p>Cadastrar um novo paciente</p>
        </div>
      </button>

      <button class="action-card" (click)="novaConsulta()">
        <div class="action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
        <div class="action-content">
          <h3>Nova Consulta</h3>
          <p>Agendar uma nova consulta</p>
        </div>
      </button>

      <button class="action-card" (click)="verConsultas()">
        <div class="action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
          </svg>
        </div>
        <div class="action-content">
          <h3>Ver Consultas</h3>
          <p>Gerenciar consultas agendadas</p>
        </div>
      </button>
    </div>
  </div>

  <!-- Grid de Conteúdo -->
  <div class="content-grid">
    <!-- Consultas de Hoje -->
    <div class="content-card">
      <div class="card-header">
        <h2 class="card-title">Consultas de Hoje</h2>
        @if (consultasHoje().length > 0) {
          <span class="badge badge-primary">
            {{ consultasHoje().length }} {{ consultasHoje().length === 1 ? 'consulta' : 'consultas' }}
          </span>
        }
      </div>
      <div class="card-body">
        @if (loadingConsultas()) {
          <div class="section-loading">
            <div class="spinner-small"></div>
            <p>Carregando consultas...</p>
          </div>
        } @else {
          <div class="consulta-list">
          @for (consulta of consultasHoje(); track consulta.id) {
            <div class="consulta-item">
              <div class="consulta-avatar">
                <span>{{ consulta.iniciais }}</span>
              </div>
              <div class="consulta-info">
                <h3 class="consulta-nome">{{ consulta.nomePaciente }}</h3>
                <p class="consulta-tipo">{{ consulta.objetivo || 'Consulta nutricional' }}</p>
              </div>
              <div class="consulta-horario">
                <span>{{ consulta.horario | date: 'HH:mm' }}</span>
              </div>
            </div>
          }

          <!-- Estado Vazio Melhorado -->
          @if (consultasHoje().length === 0) {
            <div class="empty-state">
            <div class="empty-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
            </div>
            <h3 class="empty-title">Nenhuma consulta agendada</h3>
            <p class="empty-message">Você não tem consultas agendadas para hoje</p>
          </div>
          }
        </div>
        }
      </div>
    </div>

    <!-- Pacientes Recentes -->
    <div class="content-card">
      <div class="card-header">
        <h2 class="card-title">Pacientes Recentes</h2>
        <button class="link-button" (click)="verTodosPacientes()">
          Ver todos
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      <div class="card-body">
        @if (loadingPacientes()) {
          <div class="section-loading">
            <div class="spinner-small"></div>
            <p>Carregando pacientes...</p>
          </div>
        } @else {
          <div class="paciente-list">
          @for (paciente of pacientesRecentes(); track paciente.id) {
            <div class="paciente-item" (click)="verDetalhesPaciente(paciente.id!)">
              <div class="paciente-avatar">
                <span>{{ getIniciais(paciente.nomeCompleto) }}</span>
              </div>
              <div class="paciente-info">
                <h3 class="paciente-nome">{{ paciente.nomeCompleto }}</h3>
                <p class="paciente-data">Última visita: {{ formatarData(paciente.ultimaConsulta) }}</p>
              </div>
              <button class="icon-button" (click)="ligarPaciente(paciente.telefoneWhatsapp, $event)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
              </svg>
            </button>
          </div>
          }

          <!-- Estado Vazio Melhorado -->
          @if (pacientesRecentes().length === 0) {
            <div class="empty-state">
            <div class="empty-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </div>
            <h3 class="empty-title">Nenhum paciente cadastrado</h3>
            <p class="empty-message">Cadastre seu primeiro paciente para começar</p>
            <button class="btn-primary-sm" (click)="novoPaciente()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Cadastrar Paciente
            </button>
          </div>
          }
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="spinner"></div>
      <p>Carregando dados...</p>
    </div>
  }
</div>