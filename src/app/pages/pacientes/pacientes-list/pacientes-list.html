<div class="pacientes-container">
  <div class="pacientes-header">
    <div class="header-content">
      <h1 class="page-title">Pacientes</h1>
      <p class="page-subtitle">Gerencie seus pacientes cadastrados</p>
    </div>
    <button class="btn-primary" (click)="novoPaciente()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Novo Paciente
    </button>
  </div>

  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Carregando pacientes...</p>
    </div>
  } @else if (pacientes().length === 0) {
    <div class="empty-state-container">
      <div class="empty-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <h3>Nenhum paciente encontrado</h3>
        <p>Ainda não há pacientes cadastrados no sistema.</p>
      </div>
    </div>
  } @else {
    <div class="search-container">
    <div class="search-input-wrapper">
      <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        class="search-input" 
        placeholder="Buscar por nome ou CPF..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event)"
      >
    </div>
  </div>

    <div class="table-container">
      <table class="pacientes-table">
        <thead>
          <tr>
            <th>Paciente</th>
            <th>CPF</th>
            <th>Telefone</th>
            <th>Última Visita</th>
            <th>Consultas</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @for (paciente of pacientesFiltrados(); track paciente.id) {
            <tr (click)="verDetalhes(paciente.id!)" class="table-row">
              <td>
                <div class="paciente-cell">
                  <div class="paciente-avatar">
                    <span>{{ paciente.iniciais }}</span>
                  </div>
                  <div class="paciente-info">
                    <div class="paciente-nome">{{ paciente.nomeCompleto }}</div>
                    <div class="paciente-email">{{ paciente.email || '-' }}</div>
                  </div>
                </div>
              </td>
              <td>{{ paciente.cpf }}</td>
              <td>
                <button class="whatsapp-button" (click)="abrirWhatsApp(paciente.telefoneWhatsapp); $event.stopPropagation()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                  </svg>
                  WhatsApp
                </button>
              </td>
              <td>{{ paciente.ultimaVisita || '-' }}</td>
              <td>
                <span class="badge-consultas">{{ paciente.totalConsultas || 0 }} consultas</span>
              </td>
              <td>
                <button class="icon-button" (click)="verDetalhes(paciente.id!); $event.stopPropagation()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 18 15 12 9 6"></polyline>
                  </svg>
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="empty-state">
                <div class="empty-content">
                  <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <h3>Nenhum paciente encontrado</h3>
                  <p>Nenhum paciente corresponde à sua busca.</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>